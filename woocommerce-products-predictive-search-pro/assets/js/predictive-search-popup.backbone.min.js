jQuery(document).ready(function(e){var t=wc_ps_vars.legacy_api_url;var n=wc_ps_vars.permalink_structure;var r=wc_ps_vars.search_page_url;var i=wc_ps_vars.minChars;var s=wc_ps_vars.delay;var o={apps:{},models:{},collections:{},views:{}};_.templateSettings={evaluate:/\{\{(.+?)\}\}/g,interpolate:/\{\{=(.+?)\}\}/g,escape:/\{\{-(.+?)\}\}/g};o.models.Item=Backbone.Model.extend({defaults:{title:"Empty Product",keyword:"",url:null,image_url:null,sku:null,price:null,description:null,type:"product",status:true}});o.collections.Items=Backbone.Collection.extend({model:o.models.Item,totalItems:function(){return this.where({status:true}).length},haveItems:function(e){return this.where({type:e}).length}});o.views.Item=Backbone.View.extend({tagName:"li",className:function(e){return"ac_odd"},itemTpl:_.template(e("#wc_psearch_itemTpl").html()),footerTpl:_.template(e("#wc_psearch_footerTpl").html()),initialize:function(){this.listenTo(this.model,"destroy",this.remove)},render:function(){switch(this.model.get("type")){case"header":this.$el.html('<div class="ajax_search_content_title">'+this.model.get("title")+"</div>");break;case"footer":this.$el.html(this.footerTpl(this.model.toJSON()));break;case"nothing":this.$el.html('<div class="ajax_no_result">'+this.model.get("title")+"</div>");break;default:this.$el.html(this.itemTpl(this.model.toJSON()));break}return this}});o.views.PopupResult=Backbone.View.extend({initialize:function(){this.predictive_search_input=null;this.original_ps_search_other="";this.listenTo(this.collection,"add",this.addItem);this.list_items_container=this.$(".predictive_search_results")},createItems:function(t){e.each(t,function(e,t){this.collection.add(t)}.bind(this));if(this.original_ps_search_other==""){this.original_ps_search_other=e(this.predictive_search_input).data("ps-search_other")}if(this.original_ps_search_in==""){this.original_ps_search_in=e(this.predictive_search_input).data("ps-search_in")}ps_search_other=this.original_ps_search_other.split(",");ps_id=e(this.predictive_search_input).data("ps-id");new_ps_search_other=[];new_ps_search_in="";e.each(ps_search_other,function(e,t){if(this.collection.haveItems(t)>0){new_ps_search_other.push(t);if(new_ps_search_in=="")new_ps_search_in=t}}.bind(this));if(new_ps_search_in!=""){e(this.predictive_search_input).data("ps-search_in",new_ps_search_in);e("#fr_pp_search_widget_"+ps_id).find("input[name=search_in]").val(new_ps_search_in)}if(new_ps_search_other.length==0){new_ps_search_other=[e(this.predictive_search_input).data("ps-search_in")]}e(this.predictive_search_input).data("ps-search_other",new_ps_search_other.join(","));e("#fr_pp_search_widget_"+ps_id).find("input[name=search_other]").val(new_ps_search_other.join(","))},addItem:function(t){var n=new o.views.Item({model:t});var r=n.render().el;this.list_items_container.append(r);e.data(r,"ac_data",t.attributes)},clearAll:function(){_.invoke(this.collection.where({status:true}),"destroy");return false}});o.apps.App={initialize:function(){e(document).on("click",".predictive_search_bt",this.goToSearchResultPage);e(".fr_search_widget").bind("keypress",function(e){if(e.keyCode==13){this.goToSearchResultPage(e);return false}}.bind(this));this.initPredictSearch()},initPredictSearch:function(){e(".predictive_search_input").each(function(){e(this).autocomplete(t,{minChars:i,delay:s,scrollHeight:2e3,loadingClass:"predictive_loading",highlight:false},o);e(this).result(function(t,n,r){if(n!=""){e(this).val(n)}if(r!=""&&r!=null&&r!="#")window.location=r})})},goToSearchResultPage:function(t){var i=e(t.target);ps_id=i.data("ps-id");predictive_search_input=e("#pp_course_"+ps_id);if(predictive_search_input.val()!=""&&predictive_search_input.val()!=predictive_search_input.data("ps-default_text")){if(n==""){e("#fr_pp_search_widget_"+ps_id).submit()}else{ps_keyword=predictive_search_input.val();ps_search_in=predictive_search_input.data("ps-search_in");ps_search_other=predictive_search_input.data("ps-search_other");ps_pcat=predictive_search_input.data("ps-pcat");ps_ptag=predictive_search_input.data("ps-ptag");ps_scat=predictive_search_input.data("ps-scat");ps_stag=predictive_search_input.data("ps-stag");pp_search_url=r+"/keyword/"+ps_keyword.replace("(","%28").replace(")","%29")+"/search-in/"+ps_search_in;if(typeof ps_pcat!="undefined"&&ps_pcat!=""){pp_search_url+="/pcat/"+ps_pcat}else if(typeof ps_ptag!="undefined"&&ps_ptag!=""){pp_search_url+="/ptag/"+ps_ptag}else if(typeof ps_scat!="undefined"&&ps_scat!=""){pp_search_url+="/scat/"+ps_scat}else if(typeof ps_stag!="undefined"&&ps_stag!=""){pp_search_url+="/stag/"+ps_stag}pp_search_url+="/search-other/"+ps_search_other;window.location=pp_search_url}}}};var u=o.apps.App;u.initialize()});